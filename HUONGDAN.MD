# HÆ¯á»šNG DáºªN Báº¢O TRÃŒ & Sá»¬A CHá»®A - AZ ACADEMY ATTENDANCE

**PhiÃªn báº£n:** 1.0  
**NgÃ´n ngá»¯:** Tiáº¿ng Viá»‡t + English (dual)  
**DÃ nh cho:** Developers, Maintainers, AI Agents  

---

## Má»¤C Lá»¤C (TABLE OF CONTENTS)

1. [HÆ°á»›ng Dáº«n CÃ i Äáº·t (Installation)](#1-hÆ°á»›ng-dáº«n-cÃ i-Ä‘áº·t)
2. [Cáº¥u TrÃºc ThÆ° Má»¥c Chi Tiáº¿t (Directory Map)](#2-cáº¥u-trÃºc-thÆ°-má»¥c-chi-tiáº¿t)
3. [Danh SÃ¡ch File & Chá»©c NÄƒng (File Inventory)](#3-danh-sÃ¡ch-file--chá»©c-nÄƒng)
4. [Sá»­a Chá»¯a Lá»—i Phá»• Biáº¿n (Troubleshooting)](#4-sá»­a-chá»¯a-lá»—i-phá»•-biáº¿n)
5. [Quy TrÃ¬nh Báº£o TrÃ¬ (Maintenance Workflows)](#5-quy-trÃ¬nh-báº£o-trÃ¬)
6. [Ghi ChÃ©p Thay Äá»•i (Change Log Template)](#6-ghi-chÃ©p-thay-Ä‘á»•i)

---

## 1. HÆ¯á»šNG DáºªN CÃ€I Äáº¶T

### YÃªu Cáº§u Há»‡ Thá»‘ng (Requirements)

- **WordPress:** 5.0 trá»Ÿ lÃªn
- **PHP:** 7.4 trá»Ÿ lÃªn (khuyáº¿n khÃ­ch 8.0+)
- **Database:** MySQL 5.7+ hoáº·c MariaDB 10.3+
- **Tháº» nhá»›:** Ãt nháº¥t 256MB cho WordPress
- **Quyá»n file:** wp-content/plugins vÃ  wp-content/themes pháº£i ghi Ä‘Æ°á»£c

### CÃ i Äáº·t TrÃªn LocalWP (PhÃ¡t Triá»ƒn)

#### BÆ°á»›c 1: Táº¡o Local Site

```bash
1. Má»Ÿ LocalWP (Local by Flywheel)
2. Click "Create a new site"
3. Äáº·t tÃªn site: "az-attendance"
4. Chá»n WordPress version má»›i nháº¥t
5. Username: admin
6. Password: [táº¡o máº­t kháº©u máº¡nh]
7. Click "Create Site"
```

**Káº¿t quáº£:** LocalWP táº¡o folder táº¡i:
```
C:\Users\[YourUser]\Local Sites\az-attendance\app\public\
```

#### BÆ°á»›c 2: Clone Repository

```bash
# Má»Ÿ Git Bash / Terminal táº¡i thÆ° má»¥c public
cd C:\Users\[YourUser]\Local Sites\az-attendance\app\public

# Clone repository
git clone https://github.com/tuannho0802/Az-Attendance-WordPress.git temp

# Di chuyá»ƒn plugin vÃ  theme
mv temp/plugins/az-academy-core wp-content/plugins/
mv temp/themes/az-academy wp-content/themes/
rm -rf temp
```

#### BÆ°á»›c 3: KÃ­ch Hoáº¡t Plugin & Theme

```
1. Truy cáº­p WordPress Admin (http://az-attendance.local/wp-admin)
2. ÄÄƒng nháº­p vá»›i tÃ i khoáº£n admin
3. Appearance â†’ Themes â†’ KÃ­ch hoáº¡t "Az Academy"
4. Plugins â†’ TÃ¬m "Az Academy Core" â†’ Click "Activate"
```

#### BÆ°á»›c 4: Kiá»ƒm Tra CÃ i Äáº·t

```
1. Dashboard â†’ Xem "Manage Attendance" menu xuáº¥t hiá»‡n
2. Kiá»ƒm tra database:
   - phpMyAdmin: wp_az_attendance table tá»“n táº¡i?
   - Náº¿u khÃ´ng, deactivate & activate plugin láº¡i
3. Táº¡o class test:
   - Manage Attendance â†’ "Create Class"
   - Nháº­p "Test Class" â†’ Save
   - XÃ¡c nháº­n class xuáº¥t hiá»‡n trong list
```

**Náº¿u gáº·p lá»—i:** Xem pháº§n [4. Sá»­a Chá»¯a Lá»—i Phá»• Biáº¿n](#4-sá»­a-chá»¯a-lá»—i-phá»•-biáº¿n)

---

## 2. Cáº¤U TRÃšC THÆ¯ Má»¤C CHI TIáº¾T

### CÃ¢y ThÆ° Má»¥c Äáº§y Äá»§

```
Az-Attendance-WordPress/
â”œâ”€â”€ plugins/
â”‚   â””â”€â”€ az-academy-core/
â”‚       â”œâ”€â”€ az-academy-core.php              [ENTRY POINT]
â”‚       â”œâ”€â”€ includes/
â”‚       â”‚   â”œâ”€â”€ class-azac-core-helper.php   [Helper functions]
â”‚       â”‚   â”œâ”€â”€ class-azac-database.php      [DB operations]
â”‚       â”‚   â”œâ”€â”€ class-azac-admin-pages.php   [Admin UI rendering]
â”‚       â”‚   â”œâ”€â”€ class-azac-role-manager.php  [Role/permission setup]
â”‚       â”‚   â””â”€â”€ class-azac-ajax-handler.php  [AJAX endpoints]
â”‚       â”œâ”€â”€ admin/
â”‚       â”‚   â”œâ”€â”€ css/
â”‚       â”‚   â”‚   â”œâ”€â”€ admin-style.css          [Global admin styling]
â”‚       â”‚   â”‚   â”œâ”€â”€ attendance.css           [Class dashboard styles]
â”‚       â”‚   â”‚   â”œâ”€â”€ attendance-list.css      [Attendance list styles]
â”‚       â”‚   â”‚   â””â”€â”€ azac-teacher-view.css    [Teacher-specific styles]
â”‚       â”‚   â””â”€â”€ js/
â”‚       â”‚       â”œâ”€â”€ attendance.js            [Attendance interaction logic]
â”‚       â”‚       â”œâ”€â”€ attendance-list.js       [List page interactions]
â”‚       â”‚       â””â”€â”€ class-edit.js            [Student addition logic]
â”‚       â””â”€â”€ templates/
â”‚           â”œâ”€â”€ admin-header.php             [Admin page header]
â”‚           â”œâ”€â”€ class-card-template.php      [Class card component]
â”‚           â”œâ”€â”€ attendance-table-template.php [Attendance table component]
â”‚           â””â”€â”€ badge-template.php           [Status badge component]
â”‚
â”œâ”€â”€ themes/
â”‚   â””â”€â”€ az-academy/
â”‚       â”œâ”€â”€ style.css                        [Frontend styling]
â”‚       â”œâ”€â”€ index.php                        [Homepage]
â”‚       â”œâ”€â”€ single-az_class.php              [Single class page]
â”‚       â”œâ”€â”€ header.php                       [Header template]
â”‚       â””â”€â”€ footer.php                       [Footer template]
â”‚
â””â”€â”€ README.md                                [Project overview]
```

### Giáº£i ThÃ­ch ThÆ° Má»¥c

| ThÆ° Má»¥c | Má»¥c ÄÃ­ch | AI Agent cáº§n biáº¿t gÃ¬ |
|---------|---------|----------------------|
| `plugins/az-academy-core/` | Háº¡t nhÃ¢n plugin (admin-first) | Táº¥t cáº£ logic chÃ­nh á»Ÿ Ä‘Ã¢y |
| `includes/` | Business logic (DB, roles, pages) | KhÃ´ng Ä‘Æ°á»£c phÃ¡: ká»¹ thuáº­t cao |
| `admin/css/` | Styling toÃ n bá»™ giao diá»‡n admin | Pháº£i giá»¯ `.azac-` namespace |
| `admin/js/` | TÆ°Æ¡ng tÃ¡c (AJAX, toggles, forms) | Pháº£i dÃ¹ng fetch, nonce verification |
| `templates/` | Reusable HTML partials | CÃ³ thá»ƒ má»Ÿ rá»™ng dá»… dÃ ng |
| `themes/az-academy/` | Frontend (khÃ´ng báº¯t buá»™c) | CÃ³ thá»ƒ custom hoáº·c ignore |

---

## 3. DANH SÃCH FILE & CHá»¨C NÄ‚NG

### 3.1 Plugin Core Files

#### âœ… `az-academy-core.php` (Entry Point)
**DÃ²ng mÃ£:** ~200-300 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
[âœ“] Plugin header metadata
[âœ“] Custom Post Type registration (az_class, az_student)
[âœ“] Database table creation on activation
[âœ“] CSS/JS enqueue
[âœ“] Admin menu registration
[âœ“] Role initialization
```

**Khi cáº§n sá»­a:**
- ThÃªm CPT má»›i? â†’ ThÃªm `register_post_type()` call
- ThÃªm script/CSS? â†’ ThÃªm vÃ o `azac_enqueue_admin_assets()`
- ThÃªm admin menu? â†’ ThÃªm `add_menu_page()` call

**Cáº£nh bÃ¡o:** KhÃ´ng Ä‘Æ°á»£c xÃ³a activation hook, sáº½ máº¥t báº£ng dá»¯ liá»‡u!

---

#### âœ… `includes/class-azac-core-helper.php` (Helper Functions)
**DÃ²ng mÃ£:** ~400-500 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
azac_get_class_by_id($class_id)           â†’ Láº¥y thÃ´ng tin lá»›p
azac_get_students_in_class($class_id)     â†’ Danh sÃ¡ch há»c viÃªn
azac_format_date($date, $format)          â†’ Format ngÃ y
azac_get_attendance_by_date($class_id)    â†’ Láº¥y Ä‘iá»ƒm danh
azac_get_badge_class($status)             â†’ CSS badge
azac_check_user_access($user_id, $class)  â†’ Kiá»ƒm tra quyá»n
azac_paginate(...)                        â†’ PhÃ¢n trang
azac_sanitize_input($input, $type)        â†’ Vá»‡ sinh input
```

**Khi cáº§n sá»­a:**
- ThÃªm helper má»›i? â†’ ThÃªm function vÃ o file nÃ y
- Sá»­a logic date? â†’ Sá»­a `azac_format_date()`
- ThÃªm loáº¡i badge? â†’ Sá»­a `azac_get_badge_class()`

**Cáº£nh bÃ¡o:** Thay Ä‘á»•i signature function sáº½ break táº¥t cáº£ nÆ¡i dÃ¹ng!

---

#### âœ… `includes/class-azac-database.php` (DB Operations)
**DÃ²ng mÃ£:** ~300-400 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
azac_create_attendance_table()             â†’ Táº¡o báº£ng on activation
azac_insert_attendance(...)                â†’ LÆ°u/cáº­p nháº­t Ä‘iá»ƒm danh
azac_get_attendance_records(...)           â†’ Láº¥y báº£n ghi
azac_delete_attendance($id)                â†’ XÃ³a báº£n ghi
azac_get_attendance_stats(...)             â†’ Thá»‘ng kÃª
```

**Khi cáº§n sá»­a:**
- ThÃªm cá»™t má»›i? â†’ Cáº­p nháº­t `CREATE TABLE` statement
- Thay Ä‘á»•i schema? â†’ Increment version, trigger re-activation
- ThÃªm query? â†’ DÃ¹ng wpdb global: `global $wpdb; $wpdb->query(...)`

**Cáº£nh bÃ¡o:** Sai SQL sáº½ crash toÃ n bá»™ há»‡ thá»‘ng!

**VÃ­ dá»¥ an toÃ n:**
```php
global $wpdb;
$result = $wpdb->insert(
    $wpdb->prefix . 'az_attendance',
    [
        'class_id' => $class_id,
        'student_id' => $student_id,
        'session_date' => $date,
        'status' => $status,
    ],
    ['%d', '%d', '%s', '%d']
);
```

---

#### âœ… `includes/class-azac-admin-pages.php` (Admin UI)
**DÃ²ng mÃ£:** ~800-1000 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
azac_attendance_manage_page()              â†’ Trang manage (class cards)
azac_class_dashboard_page()                â†’ Trang Ä‘iá»ƒm danh (tabs)
azac_render_class_card($class)             â†’ ThÃ nh pháº§n class card
azac_render_attendance_table(...)          â†’ Báº£ng Ä‘iá»ƒm danh
azac_render_inline_create_class_form()     â†’ Form táº¡o lá»›p
azac_render_student_addition_form()        â†’ Form thÃªm há»c viÃªn
```

**Khi cáº§n sá»­a:**
- ThÃªm cá»™t báº£ng? â†’ ThÃªm `<td data-label="...">` 
- Thay Ä‘á»•i card layout? â†’ Sá»­a HTML structure
- ThÃªm form field? â†’ ThÃªm `<input>` + JS validation

**CRITICAL:** Má»i `<td>` pháº£i cÃ³ `data-label` hoáº·c mobile vá»¡!

**VÃ­ dá»¥ sai:**
```php
// âŒ Sáº¼ Vá»  TRÃŠN MOBILE
echo '<td>Student Name: John</td>';
```

**VÃ­ dá»¥ Ä‘Ãºng:**
```php
// âœ… ÄÃšNG - Mobile sáº½ hiá»ƒn thá»‹ label
echo '<td data-label="Student Name">John</td>';
```

---

#### âœ… `includes/class-azac-role-manager.php` (Role Management)
**DÃ²ng mÃ£:** ~250-350 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
azac_register_custom_roles()                â†’ Táº¡o az_teacher, az_student
azac_check_class_access($user_id, $id)     â†’ Kiá»ƒm tra quyá»n truy cáº­p
azac_migrate_wp_roles_to_custom()           â†’ Migrate role on activation
azac_get_user_classes($user_id)             â†’ Danh sÃ¡ch lá»›p cá»§a user
```

**Khi cáº§n sá»­a:**
- ThÃªm role má»›i? â†’ ThÃªm `add_role()` call
- Thay Ä‘á»•i capability? â†’ Sá»­a array `$caps`
- Thay Ä‘á»•i access logic? â†’ Sá»­a `check_class_access()`

**Cáº£nh bÃ¡o:** Sai permission logic â†’ user máº¥t access!

---

#### âœ… `includes/class-azac-ajax-handler.php` (AJAX Endpoints)
**DÃ²ng mÃ£:** ~400-500 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
wp_ajax_azac_save_attendance                â†’ LÆ°u Ä‘iá»ƒm danh (toggle)
wp_ajax_azac_create_class                   â†’ Táº¡o lá»›p (AJAX)
wp_ajax_azac_add_student_to_class           â†’ ThÃªm há»c viÃªn
wp_ajax_azac_delete_attendance              â†’ XÃ³a báº£n ghi
```

**Khi cáº§n sá»­a:**
- ThÃªm endpoint má»›i? â†’ ThÃªm `add_action('wp_ajax_azac_...')`
- Sá»­a validation? â†’ Sá»­a `check_ajax_referer()` + `sanitize_*()`
- Thay Ä‘á»•i response? â†’ Sá»­a `wp_send_json_*()`

**CRITICAL PATTERN:**
```php
add_action('wp_ajax_azac_my_action', function() {
    // 1. Verify nonce (SECURITY)
    check_ajax_referer('azac_nonce', 'nonce');
    
    // 2. Check capability
    if (!current_user_can('edit_posts')) {
        wp_send_json_error(['message' => 'Forbidden']);
    }
    
    // 3. Sanitize input
    $input = sanitize_text_field($_POST['input']);
    
    // 4. Do work
    $result = do_something($input);
    
    // 5. Send response
    wp_send_json_success(['data' => $result]);
});
```

---

### 3.2 Admin CSS Files

#### âœ… `admin/css/admin-style.css` (Global Styles)
**DÃ²ng mÃ£:** ~1000-1500 dÃ²ng  
**Classes chÃ­nh:**
```
.azac-admin-teal              â†’ Container chÃ­nh (specificity override)
.azac-card                    â†’ Card component
.azac-table-responsive        â†’ Wrapper cho báº£ng
.azac-switch                  â†’ Toggle switch (attendance)
.azac-badge, .azac-badge-*   â†’ Status badges (success, error, warning)
.azac-btn, .azac-btn-primary  â†’ Button styles
.azac-input-group             â†’ Form input wrapper
.azac-section                 â†’ Section divider
```

**Khi cáº§n sá»­a:**
- ThÃªm class má»›i? â†’ ThÃªm rule má»›i, báº¯t Ä‘áº§u vá»›i `.azac-`
- Thay Ä‘á»•i mÃ u? â†’ Sá»­a CSS variable hoáº·c color value
- Fix mobile? â†’ ThÃªm `@media (max-width: 782px)` rule

**LÆ°u Ã½ Namespace:**
```css
/* âœ… CORRECT - Specific, won't conflict */
.azac-admin-teal .azac-card { }

/* âŒ WRONG - Too generic, may conflict */
.card { }
.admin { }
```

---

#### âœ… `admin/css/attendance.css` (Dashboard Styles)
**DÃ²ng mÃ£:** ~500-700 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
[âœ“] Tab styling (active/inactive states)
[âœ“] Attendance table layout
[âœ“] Summary cards styling
[âœ“] Chart container
[âœ“] Mobile card layout (display: block)
```

**Khi cáº§n sá»­a:**
- ThÃªm tab? â†’ ThÃªm `.azac-tab-content` + CSS
- Fix card layout? â†’ Kiá»ƒm tra mobile breakpoint
- Thay Ä‘á»•i summary? â†’ Sá»­a `.azac-summary-card`

---

#### âœ… `admin/css/attendance-list.css` (List Page Styles)
**DÃ²ng mÃ£:** ~300-400 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
[âœ“] Class cards grid layout
[âœ“] Card spacing and borders
[âœ“] Responsive grid (desktop vs mobile)
[âœ“] Inline form styling
```

---

#### âœ… `admin/css/azac-teacher-view.css` (Teacher Role Styles)
**DÃ²ng mÃ£:** ~200-300 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```
[âœ“] Simplified toolbar (teacher-only)
[âœ“] Hidden admin elements
[âœ“] Teacher-specific colors/layout
```

**Khi cáº§n sá»­a:**
- áº¨n element tá»« teacher? â†’ ThÃªm `display: none` vá»›i specificity Ä‘á»§ cao

---

### 3.3 Admin JavaScript Files

#### âœ… `admin/js/attendance.js` (Main Interaction Logic)
**DÃ²ng mÃ£:** ~600-800 dÃ²ng  
**Functions chÃ­nh:**
```javascript
toggleAttendance(studentId, type, status)     // Toggle switch
saveAttendance(classId, sessionDate, type)    // Save all (AJAX)
loadAttendanceState(classId, date, type)      // Load on page load
updateSummaryCards()                           // Recalculate stats
initializeChart()                              // Setup Chart.js
```

**Khi cáº§n sá»­a:**
- ThÃªm field má»›i? â†’ ThÃªm vÃ o `attendanceData` object
- Thay Ä‘á»•i AJAX call? â†’ Sá»­a `fetch()` + URL params
- Thay Ä‘á»•i chart? â†’ Sá»­a Chart.js config

**VÃ­ dá»¥ thÃªm note field:**
```javascript
const updateNote = (studentId, type, note) => {
    attendanceData[studentId][type].note = sanitizeHtml(note);
    // Save to server...
};
```

---

#### âœ… `admin/js/attendance-list.js` (List Page Logic)
**DÃ²ng mÃ£:** ~300-400 dÃ²ng  
**Functions chÃ­nh:**
```javascript
openClassDashboard(classId)      // Navigate to class
deleteClass(classId)              // Delete + confirm
initializeClassCards()            // Event listeners
filterClasses(searchTerm)          // Search/filter
```

---

#### âœ… `admin/js/class-edit.js` (Student Addition Logic)
**DÃ²ng mÃ£:** ~250-350 dÃ²ng  
**Functions chÃ­nh:**
```javascript
addStudentRow()                   // Add input row
removeStudentRow(rowIndex)        // Remove row
validateStudentForm()             // Validation
submitStudentData()               // AJAX save
```

**Khi cáº§n sá»­a:**
- ThÃªm field student? â†’ ThÃªm `<input>` row + validation
- Thay Ä‘á»•i validation? â†’ Sá»­a `validateStudentForm()`

---

### 3.4 Templates

#### âœ… `templates/admin-header.php`
**Chá»©c nÄƒng:** Render header cho admin pages  
**Variables:**
```php
$title = 'Page Title';
$breadcrumbs = ['Home', 'Manage', 'Current Page'];
$actions = ['Create', 'Export', ...];
```

---

#### âœ… `templates/class-card-template.php`
**Chá»©c nÄƒng:** Render single class card  
**Variables:**
```php
$class = [
    'ID' => 123,
    'post_title' => 'Class Name',
    'teacher_name' => 'John Teacher',
    'total_sessions' => 10,
    'student_count' => 25,
];
```

---

#### âœ… `templates/attendance-table-template.php`
**Chá»©c nÄƒng:** Render attendance table (editable or view-only)  
**Variables:**
```php
$students = [...];
$attendance_records = [...];
$editable = true;
$session_date = '2024-02-06';
```

---

#### âœ… `templates/badge-template.php`
**Chá»©c nÄƒng:** Render status badge  
**Variables:**
```php
$status = 'success'; // success | error | warning | info
$label = 'Present';
```

---

### 3.5 Theme Files

#### âœ… `themes/az-academy/style.css`
**DÃ²ng mÃ£:** ~400-600 dÃ²ng  
**Chá»©c nÄƒng chÃ­nh:**
```css
[âœ“] Theme header metadata
[âœ“] Primary color scheme
[âœ“] Typography (fonts, sizes)
[âœ“] Layout (header, footer, body)
[âœ“] Card and button styles
[âœ“] Responsive breakpoints
```

---

#### âœ… `themes/az-academy/index.php`
**Chá»©c nÄƒng:** Homepage  
**Displays:**
```
[âœ“] Site header (via header.php)
[âœ“] Loop: list of az_class posts as cards
[âœ“] Each card: title, teacher, sessions, student count
[âœ“] Links to single-az_class.php
[âœ“] Site footer (via footer.php)
```

**Khi cáº§n sá»­a:**
- ThÃªm filter? â†’ ThÃªm `WP_Query` args
- Thay Ä‘á»•i card layout? â†’ Sá»­a HTML structure
- ThÃªm pagination? â†’ ThÃªm `paginate_links()`

---

#### âœ… `themes/az-academy/single-az_class.php`
**Chá»©c nÄƒng:** Single class page  
**Displays:**
```
[âœ“] Site header
[âœ“] Class title, teacher, description
[âœ“] Total sessions, student count
[âœ“] Student list (if visible)
[âœ“] "Edit in Admin" button (if authorized)
[âœ“] Site footer
```

---

#### âœ… `themes/az-academy/header.php`
**Chá»©c nÄƒng:** Header template  
**Includes:**
```html
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- wp_head() hooks for theme CSS, plugin CSS, etc -->
</head>
<body>
    <!-- Navigation menu -->
    <!-- Admin bar (if logged in) -->
```

---

#### âœ… `themes/az-academy/footer.php`
**Chá»©c nÄƒng:** Footer template  
**Outputs:**
```html
    <!-- wp_footer() hooks for JS -->
    <!-- Copyright, credits -->
</body>
</html>
```

---

## 4. Sá»¬A CHá»®A Lá»–I PHá»” BIáº¾N

### Lá»—i #1: Plugin khÃ´ng kÃ­ch hoáº¡t Ä‘Æ°á»£c

**Triá»‡u chá»©ng:**
```
"Parse error in az-academy-core.php line 50"
hoáº·c
"Fatal error: Call to undefined function..."
```

**NguyÃªn nhÃ¢n:**
- File PHP cÃ³ syntax error
- Thiáº¿u file include
- PHP version quÃ¡ cÅ©

**CÃ¡ch sá»­a:**

1. **Kiá»ƒm tra syntax:**
```bash
php -l plugins/az-academy-core/az-academy-core.php
```

2. **Kiá»ƒm tra logs:**
```bash
tail -50 wp-content/debug.log
```

3. **Kiá»ƒm tra file includes:**
```php
// Trong az-academy-core.php, kiá»ƒm tra include_once
include_once plugin_dir_path(__FILE__) . 'includes/class-azac-database.php';
// File nÃ y tá»“n táº¡i khÃ´ng?
```

---

### Lá»—i #2: Báº£ng dá»¯ liá»‡u khÃ´ng Ä‘Æ°á»£c táº¡o

**Triá»‡u chá»©ng:**
```
"Table 'wp_az_attendance' doesn't exist"
khi lÆ°u Ä‘iá»ƒm danh
```

**NguyÃªn nhÃ¢n:**
- Activation hook khÃ´ng cháº¡y
- Quyá»n database khÃ´ng Ä‘á»§
- Upgrade tá»« version cÅ© chÆ°a migrate

**CÃ¡ch sá»­a:**

1. **Re-activate plugin:**
```
Plugins â†’ Az Academy Core â†’ Deactivate
Plugins â†’ Az Academy Core â†’ Activate
```

2. **Kiá»ƒm tra báº£ng tá»“n táº¡i:**
```bash
# phpMyAdmin hoáº·c WP-CLI
wp db tables | grep az_attendance
```

3. **Táº¡o báº£ng thá»§ cÃ´ng (náº¿u cáº§n):**
```sql
-- Cháº¡y trong phpMyAdmin
CREATE TABLE `wp_az_attendance` (
    `id` bigint unsigned NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `class_id` bigint unsigned NOT NULL,
    `student_id` bigint unsigned NOT NULL,
    `session_date` date NOT NULL,
    `attendance_type` varchar(20) NOT NULL DEFAULT 'check-in',
    `status` tinyint(1) NOT NULL DEFAULT 0,
    `note` text,
    `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
    `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    KEY `class_id` (`class_id`),
    KEY `student_id` (`student_id`),
    KEY `session_date` (`session_date`),
    UNIQUE KEY `unique_attendance` (`class_id`, `student_id`, `session_date`, `attendance_type`)
);
```

---

### Lá»—i #3: Mobile view vá»¡ (báº£ng khÃ´ng cÃ³ label)

**Triá»‡u chá»©ng:**
```
TrÃªn Ä‘iá»‡n thoáº¡i (<782px): cá»™t báº£ng khÃ´ng cÃ³ nhÃ£n,
chá»‰ tháº¥y dá»¯ liá»‡u
```

**NguyÃªn nhÃ¢n:**
- `<td>` khÃ´ng cÃ³ `data-label="..."`
- CSS mobile breakpoint sai

**CÃ¡ch sá»­a:**

1. **Kiá»ƒm tra táº¥t cáº£ `<td>` cÃ³ label:**
```php
// âŒ SAI
echo '<td>John Doe</td>';

// âœ… ÄÃšNG
echo '<td data-label="Student Name">John Doe</td>';
```

2. **Kiá»ƒm tra CSS:**
```css
/* admin-style.css pháº£i cÃ³ */
@media (max-width: 782px) {
    table { display: block; }
    td {
        display: flex;
        justify-content: space-between;
    }
    td::before {
        content: attr(data-label);
        font-weight: bold;
    }
}
```

3. **Test trÃªn DevTools:**
```
F12 â†’ DevTools â†’ Ctrl+Shift+M (toggle mobile)
Drag width to < 782px
Kiá»ƒm tra má»—i <td> cÃ³ label khÃ´ng
```

---

### Lá»—i #4: Attendance khÃ´ng lÆ°u Ä‘Æ°á»£c (AJAX fail)

**Triá»‡u chá»©ng:**
```
Click toggle attendance â†’ khÃ´ng cÃ³ gÃ¬ xáº£y ra
F12 Console: XHR request failed hoáº·c 400/403
```

**NguyÃªn nhÃ¢n:**
- Nonce sai hoáº·c háº¿t háº¡n
- User khÃ´ng cÃ³ quyá»n
- AJAX URL sai
- Backend error

**CÃ¡ch sá»­a:**

1. **Kiá»ƒm tra nonce trong HTML:**
```html
<!-- Má»Ÿ Page Source (Ctrl+U) tÃ¬m -->
<input type="hidden" name="nonce" value="abc123...">
```

2. **Kiá»ƒm tra AJAX log:**
```bash
# F12 â†’ Network tab â†’ tÃ¬m admin-ajax.php requests
# Kiá»ƒm tra:
# - Status: 200 OK?
# - Response: { success: true } ?
# - Parameters: action, nonce, student_id, status ?
```

3. **Kiá»ƒm tra PHP error log:**
```bash
tail wp-content/debug.log | grep "azac_save_attendance"
```

4. **Fix nonce (client side):**
```javascript
// attendance.js
const nonce = document.querySelector('[name="nonce"]').value;
if (!nonce) {
    console.error('Nonce not found in page!');
    return;
}

fetch(ajaxUrl, {
    method: 'POST',
    body: new FormData(document.querySelector('form'))
    // hoáº·c
    // body: `action=azac_save_attendance&nonce=${nonce}&...`
});
```

5. **Fix nonce (server side):**
```php
// Trong class-azac-ajax-handler.php
add_action('wp_ajax_azac_save_attendance', function() {
    // Check nonce FIRST
    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'azac_nonce')) {
        wp_send_json_error(['message' => 'Nonce verification failed']);
    }
    
    // Then check capability
    if (!current_user_can('edit_posts')) {
        wp_send_json_error(['message' => 'Insufficient permissions']);
    }
    
    // Then process...
});
```

---

### Lá»—i #5: User khÃ´ng tháº¥y class (Permission denied)

**Triá»‡u chá»©ng:**
```
Teacher account: "Manage Attendance" menu khÃ´ng xuáº¥t hiá»‡n
hoáº·c
Há»c viÃªn: chá»‰ tháº¥y má»™t sá»‘ class
```

**NguyÃªn nhÃ¢n:**
- User khÃ´ng Ä‘Æ°á»£c assign vÃ o lá»›p
- Role sai
- Access check logic sai

**CÃ¡ch sá»­a:**

1. **Kiá»ƒm tra user role:**
```php
// Cháº¡y trong wp-cli hoáº·c admin
$user = get_user_by('login', 'teacher_username');
$user_roles = $user->roles; // Should contain 'az_teacher'
```

2. **Kiá»ƒm tra class assignment:**
```php
// Check postmeta
$class_id = 123;
$teacher_id = 456;

// Láº¥y teacher assigned
$assigned_teacher = get_post_meta($class_id, 'az_teacher_user', true);
echo "Assigned: $assigned_teacher, Looking for: $teacher_id";
```

3. **Manually assign (fix):**
```php
// Trong WordPress admin hoáº·c WP-CLI
update_post_meta($class_id, 'az_teacher_user', $teacher_id);
```

4. **Kiá»ƒm tra access logic:**
```php
// class-azac-role-manager.php
function azac_check_class_access($user_id, $class_id) {
    if (current_user_can('manage_options')) return true;
    
    $assigned_teacher = get_post_meta($class_id, 'az_teacher_user', true);
    return ($user_id == $assigned_teacher);
}
```

---

### Lá»—i #6: CSS khÃ´ng load (giao diá»‡n xáº¥u)

**Triá»‡u chá»©ng:**
```
Admin page khÃ´ng cÃ³ styling (chá»‰ text tráº¯ng)
```

**NguyÃªn nhÃ¢n:**
- CSS file sai path
- Enqueue sai
- Cache plugin blocking

**CÃ¡ch sá»­a:**

1. **Kiá»ƒm tra enqueue:**
```php
// az-academy-core.php
add_action('admin_enqueue_scripts', function() {
    wp_enqueue_style(
        'azac-admin-style',
        plugin_dir_url(__FILE__) . 'admin/css/admin-style.css',
        [],
        filemtime(plugin_dir_path(__FILE__) . 'admin/css/admin-style.css')
    );
});
```

2. **Kiá»ƒm tra file tá»“n táº¡i:**
```bash
ls -la plugins/az-academy-core/admin/css/
# admin-style.css cÃ³ tá»“n táº¡i khÃ´ng?
```

3. **Clear cache:**
```bash
# Náº¿u dÃ¹ng caching plugin (WP Super Cache, W3 Total Cache)
# XÃ³a cache
# Hoáº·c táº¡m disable cache plugin
```

4. **Kiá»ƒm tra dev tools:**
```
F12 â†’ Network â†’ CSS files
- Status 200?
- Ná»™i dung cÃ³ CSS khÃ´ng (khÃ´ng pháº£i HTML error)?
```

---

### Lá»—i #7: JavaScript lá»—i (toggle khÃ´ng Ä‘á»™ng)

**Triá»‡u chá»©ng:**
```
F12 Console: Uncaught ReferenceError: ... is not defined
Toggle button click â†’ khÃ´ng cÃ³ gÃ¬ xáº£y ra
```

**NguyÃªn nhÃ¢n:**
- File JS khÃ´ng load
- Global variable sai
- Function khÃ´ng defined

**CÃ¡ch sá»­a:**

1. **Kiá»ƒm tra JS file load:**
```bash
# F12 â†’ Network â†’ Filter: JS
# TÃ¬m attendance.js â†’ Status 200?
```

2. **Kiá»ƒm trap global variables:**
```javascript
// Trong attendance.js, pháº£i define
const ajaxUrl = '<?php echo admin_url('admin-ajax.php'); ?>';
const classDashboardNonce = '<?php echo wp_create_nonce('azac_nonce'); ?>';
```

3. **Kiá»ƒm tra PHP inline script:**
```php
// Trong class-azac-admin-pages.php
?>
<script>
    var ajaxUrl = '<?php echo admin_url('admin-ajax.php'); ?>';
    var nonce = '<?php echo wp_create_nonce('azac_nonce'); ?>';
</script>
<?php
wp_enqueue_script('azac-attendance', ...);
```

---

## 5. QUY TRÃŒNH Báº¢O TRÃŒ

### 5.1 HÃ ng NgÃ y (Daily)

- [ ] Kiá»ƒm tra plugin error log: `wp-content/debug.log`
- [ ] Verify attendance data persisting correctly
- [ ] Check user reports of access issues

### 5.2 HÃ ng Tuáº§n (Weekly)

- [ ] Database backup
- [ ] Review attendance records for inconsistencies
- [ ] Test AJAX endpoints manually
- [ ] Verify mobile responsiveness (< 782px)

### 5.3 HÃ ng ThÃ¡ng (Monthly)

- [ ] Update WordPress to latest version
- [ ] Review and update plugin version number
- [ ] Audit user roles and permissions
- [ ] Performance review (slow queries?)
- [ ] Security audit (sanitization, escaping, nonce)

### 5.4 Khi Deploy Thay Äá»•i

```
1. [GIT] Commit changes
   git add .
   git commit -m "feat: add new attendance field"

2. [TEST] Test on staging/local
   - Activate plugin
   - Create test class and student
   - Test attendance toggle
   - Test on mobile (< 782px)
   - Check error log

3. [BACKUP] Backup database and files
   - wp-content/uploads
   - {prefix}_az_attendance table

4. [DEPLOY] Update production
   - Copy files to server
   - Run activation hook if needed (deactivate + activate)
   - Verify plugin active

5. [VERIFY] Smoke test on production
   - Login as admin
   - Check "Manage Attendance" exists
   - Create test class
   - Toggle attendance
   - Check no errors in log
```

---

## 6. GHI CHÃ‰P THAY Äá»”I (CHANGELOG TEMPLATE)

### Version 1.1.0 (Date: YYYY-MM-DD)

#### âœ¨ Features
- [x] Add note field to attendance record
- [x] Export attendance to CSV

#### ğŸ› Fixes
- [x] Fix mobile table label display
- [x] Fix AJAX nonce validation on slow networks

#### âš ï¸ Breaking Changes
- None

#### ğŸ“ Migration Steps
```sql
-- Add new column
ALTER TABLE wp_az_attendance ADD COLUMN `note` TEXT AFTER `status`;
```

#### ğŸ§ª Testing Checklist
- [ ] Create class, add students, toggle attendance
- [ ] Check attendance saves on toggle
- [ ] Test on mobile (< 782px)
- [ ] Verify teacher can't see other teachers' classes
- [ ] Verify student can't edit others' attendance
- [ ] Export CSV and verify format
- [ ] Check debug.log has no errors

---

## QUICK REFERENCE

### File Search Guide

| TÃ´i muá»‘n... | TÃ¬m file |
|-------------|----------|
| ThÃªm input form field | `class-azac-admin-pages.php` |
| Sá»­a AJAX endpoint | `class-azac-ajax-handler.php` |
| ThÃªm CSS class | `admin/css/admin-style.css` |
| ThÃªm helper function | `class-azac-core-helper.php` |
| ThÃªm database operation | `class-azac-database.php` |
| ThÃªm user permission | `class-azac-role-manager.php` |
| Sá»­a JavaScript interaction | `admin/js/attendance.js` |
| Thay Ä‘á»•i database schema | `az-academy-core.php` (activation hook) |

### Debugging Commands

```bash
# Check PHP syntax
php -l plugins/az-academy-core/includes/*.php

# Check logs
tail -100 wp-content/debug.log

# Check database table
wp db query "SHOW TABLES LIKE 'wp_az%'"

# Check user roles
wp user list --field=ID,user_login | xargs -I {} wp user get {} --field=roles

# Create user for testing
wp user create teacher_test teacher@test.local --role=az_teacher --user_pass=password
```

---

**Last Updated:** February 2026  
**For Questions:** See INSTRUCTION.MD for technical details
